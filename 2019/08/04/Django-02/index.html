<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>Django-02 | JJW-STORY</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="JJW-STORY">
  
  <meta name="description" content="Djongo表单从请求对象中获取数据   属性 方法说明 示例    request.path 完整的路径，不含域名，但是含前导斜线 “/hello/”   request.get_host() 主机名（即通常所说的“域名”） “127.0.0.1:8000”或“www.example.com”   request.get_full_path() 包含查询字符串（如果有的话）的路径 “/hello">
<meta name="keywords" content="Python,Django">
<meta property="og:type" content="article">
<meta property="og:title" content="Django-02">
<meta property="og:url" content="https://jjw-story.github.io/2019/08/04/Django-02/index.html">
<meta property="og:site_name" content="JJW-STORY">
<meta property="og:description" content="Djongo表单从请求对象中获取数据   属性 方法说明 示例    request.path 完整的路径，不含域名，但是含前导斜线 “/hello/”   request.get_host() 主机名（即通常所说的“域名”） “127.0.0.1:8000”或“www.example.com”   request.get_full_path() 包含查询字符串（如果有的话）的路径 “/hello">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-08-11T05:40:34.779Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Django-02">
<meta name="twitter:description" content="Djongo表单从请求对象中获取数据   属性 方法说明 示例    request.path 完整的路径，不含域名，但是含前导斜线 “/hello/”   request.get_host() 主机名（即通常所说的“域名”） “127.0.0.1:8000”或“www.example.com”   request.get_full_path() 包含查询字符串（如果有的话）的路径 “/hello">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>
  

  
  

</head>
</html>
<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">JJW-STORY</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a  href="/">
                        <i class="fa fa-home"></i>
                        <span>Home</span>
                    </a>
                    
                    <a  href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>Archives</span>
                    </a>
                    
                    <a  href="/about">
                        <i class="fa fa-user"></i>
                        <span>About</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        JJW-STORY
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        技术记录
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="JJW-STORY" target="_blank" href="//jjw-story.github.io">
                            <i class="fa fa-home fa-2x"></i></a>
                    
                        <a title="Github" target="_blank" href="//jjw-story.github.io">
                            <i class="fa fa-github fa-2x"></i></a>
                    
                        <a title="Weibo" target="_blank" href="/暂不开放">
                            <i class="fa fa-weibo fa-2x"></i></a>
                    
                        <a title="Twitter" target="_blank" href="/暂不开放">
                            <i class="fa fa-twitter fa-2x"></i></a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-Django-02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="post-title" itemprop="name">
      Django-02
    </h1>
    <div class="post-title-bar">
      <ul>
          
              <li>
                  <i class="fa fa-book"></i>
                  
                      <a href="/categories/Python/">Python</a>
                  
              </li>
          
        <li>
          <i class="fa fa-calendar"></i>  2019-08-04
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

          
      </header>
    
    <div class="article-entry post-content" itemprop="articleBody">
      
            
            <h1 id="Djongo表单"><a href="#Djongo表单" class="headerlink" title="Djongo表单"></a>Djongo表单</h1><h2 id="从请求对象中获取数据"><a href="#从请求对象中获取数据" class="headerlink" title="从请求对象中获取数据"></a>从请求对象中获取数据</h2><table>
<thead>
<tr>
<th>属性</th>
<th>方法说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>request.path</td>
<td>完整的路径，不含域名，但是含前导斜线</td>
<td>“/hello/”</td>
</tr>
<tr>
<td>request.get_host()</td>
<td>主机名（即通常所说的“域名”）</td>
<td>“127.0.0.1:8000”或“<a href="http://www.example.com”" target="_blank" rel="noopener">www.example.com”</a></td>
</tr>
<tr>
<td>request.get_full_path()</td>
<td>包含查询字符串（如果有的话）的路径</td>
<td>“/hello/?print=true”</td>
</tr>
<tr>
<td>request.is_secure()</td>
<td>通过 HTTPS 访问时为True，否则为False</td>
<td>True 或False</td>
</tr>
<tr>
<td>request.META[‘HTTP_USER_AGENT’]</td>
<td>入站前的 URL（可能没有）</td>
<td></td>
</tr>
<tr>
<td>request.META[‘HTTP_USER_AGENT’]</td>
<td>浏览器的用户代理（可能没有），请求头信息</td>
<td>“Mozilla/5.0 (X11; U; Linux i686; fr-FR; rv:1.8.1.17) Gecko/20080829 Firefox/2.0.0.17”</td>
</tr>
<tr>
<td>request.META[‘REMOTE_ADDR’]</td>
<td>客户端的 IP 地址</td>
<td>“12.345.67.89”。（如果请求经由代理，这个首部的值可能是一组 IP 地址，以逗号分隔）</td>
</tr>
</tbody></table>
<h2 id="简单的表单使用示例"><a href="#简单的表单使用示例" class="headerlink" title="简单的表单使用示例"></a>简单的表单使用示例</h2><p>这里可以打开页面及项目代码为大家演示</p>
<p>视图函数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line">from django.http import HttpResponse</span><br><span class="line">from cerealsOils.models import Product</span><br><span class="line"></span><br><span class="line"># Create your views here.</span><br><span class="line"></span><br><span class="line">def product_search(request):</span><br><span class="line">    return render(request, &apos;product_search.html&apos;)</span><br><span class="line"></span><br><span class="line">def search(request):</span><br><span class="line">    errors = []</span><br><span class="line">    if &apos;q&apos; in request.GET : # 通过request对象直接获取传统get请求的参数： q=xxx</span><br><span class="line">        if ( request.GET[&apos;q&apos;]) :    # 判断表单q参数是否为空</span><br><span class="line">            q = request.GET[&apos;q&apos;]</span><br><span class="line">            if len(q) &gt; 5 :</span><br><span class="line">                errors.append(&quot;查询关键字不能超过五个字符&quot;)</span><br><span class="line">            else :</span><br><span class="line">                products = Product.objects.filter(title__contains=q)  # 过滤查询</span><br><span class="line">                # name = products[0].vender[0]</span><br><span class="line">                return render(request, &apos;product_search.html&apos;, &#123;&apos;products&apos;: products, &apos;query&apos;: q&#125;)</span><br><span class="line">    else :</span><br><span class="line">        # products = Product.objects.all()  # 查询所有</span><br><span class="line">        errors.append(&quot;查询关键字不能为空&quot;)</span><br><span class="line">    return render(request, &apos;product_search.html&apos;, &#123;&apos;errors&apos;:errors&#125;)</span><br></pre></td></tr></table></figure>

<p>URL配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^product_search/$&apos;, views.product_search),  # 查询页面跳转</span><br><span class="line">url(r&apos;^search/$&apos;, views.search),    # 查询控制层</span><br></pre></td></tr></table></figure>

<p>product_search模板如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;title&gt;产品查询&lt;/title&gt;</span><br><span class="line">		&lt;meta charset=&apos;UTF-8&apos;&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&#123;% if errors %&#125;</span><br><span class="line">			&lt;ul&gt;</span><br><span class="line">				&#123;% for error in errors %&#125;</span><br><span class="line">					&lt;li&gt;&#123;&#123; error &#125;&#125;&lt;/li&gt;</span><br><span class="line">				&#123;% endfor %&#125;</span><br><span class="line">			&lt;/ul&gt;</span><br><span class="line">		&#123;% endif %&#125;</span><br><span class="line">		&lt;!-- &lt;form action=&quot;/search/&quot; method=&quot;get&quot;&gt; --&gt;</span><br><span class="line">		&lt;form action=&quot;/search/&quot; method=&quot;get&quot;&gt;</span><br><span class="line">			&lt;input type=&quot;text&quot; name=&quot;q&quot;&gt;</span><br><span class="line">			&lt;input type=&quot;submit&quot; value=&quot;Search&quot;&gt;</span><br><span class="line">		&lt;/form&gt;</span><br><span class="line">		&lt;p&gt;查询关键字: &lt;strong&gt;&#123;&#123; query &#125;&#125;&lt;/strong&gt;&lt;/p&gt;</span><br><span class="line">		</span><br><span class="line">		&#123;% if products %&#125;</span><br><span class="line">			&lt;p&gt;产品总数 &#123;&#123; products|length &#125;&#125; 产品&#123;&#123; books|pluralize &#125;&#125;&lt;/p&gt;</span><br><span class="line">			&lt;ul&gt;</span><br><span class="line">				&#123;% for product in products %&#125;</span><br><span class="line">					&lt;li&gt;产品名称：&#123;&#123; product.title &#125;&#125;  生产日期：&#123;&#123; product.product_date &#125;&#125;&lt;/li&gt;</span><br><span class="line">				&#123;% endfor %&#125;</span><br><span class="line">			&lt;/ul&gt;</span><br><span class="line">		&#123;% else %&#125;</span><br><span class="line">			&lt;p&gt;没有查询到商品&lt;/p&gt;</span><br><span class="line">		&#123;% endif %&#125;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>这样就完成了一个表单的使用示例</p>
<h2 id="联系表单"><a href="#联系表单" class="headerlink" title="联系表单"></a>联系表单</h2><p>Django 自带了一个表单库，django.forms，它能处理从显示 HTML 表单到验证。</p>
<p>这个表单框架的主要用法是为要处理的每个 HTML 表单定义一个Form 类，这个类可以放在任意位置，例如直接放在views.py 文件中，不过社区的约定是，把Form 类放在单独的forms.py 文件中。</p>
<p>下面对表单框架的各部分功能以及自定义校验规则等进行示例：</p>
<p>在views.py 文件所在的目录（mysite）中创建这个文件，然后输入下述内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 引入框架的表单库</span><br><span class="line">from django import forms</span><br><span class="line"></span><br><span class="line">class ContactForm(forms.Form):</span><br><span class="line">    subject = forms.CharField(max_length=20, min_length=2)  # 校验长度</span><br><span class="line">    email = forms.EmailField(required=False)    # 选项表示表单内容非必填</span><br><span class="line">    message = forms.CharField(widget=forms.Textarea)    # 可以直接设置表单样式，注意表单样式设置也可以很灵活，使用时具体查看资料</span><br><span class="line"></span><br><span class="line">    # 自定义校验规则</span><br><span class="line">    # 注意校验方法名，需要以clean_开头，字段名称为结尾</span><br><span class="line">    # 再检查此规则前定义字段时设置的校验规则已经校验完毕</span><br><span class="line">    def clean_message(self):</span><br><span class="line">        message = self.cleaned_data[&apos;message&apos;]</span><br><span class="line">        if &quot;香港&quot; in message:</span><br><span class="line">            raise forms.ValidationError(&quot;消息内容不能包含敏感词&quot;)</span><br><span class="line">        return message  # 一定要显式的返回清理后的值，cleaned_data是清理值</span><br></pre></td></tr></table></figure>

<p>定义视图函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def contact(request):</span><br><span class="line">    if request.method == &apos;POST&apos;:</span><br><span class="line">        form = ContactForm(request.POST)    # Post请求体接受为form表单对象，这点类似于mvc</span><br><span class="line">        if form.is_valid():     # 校验表单输入是否符合定义的校验规则</span><br><span class="line">            cd = form.cleaned_data</span><br><span class="line">            send_mail(</span><br><span class="line">                cd[&apos;subject&apos;],</span><br><span class="line">                cd[&apos;message&apos;],</span><br><span class="line">                cd.get(&apos;email&apos;, &apos;noreply@example.com&apos;),</span><br><span class="line">                [&apos;siteowner@example.com&apos;],</span><br><span class="line">            )</span><br><span class="line">            return HttpResponseRedirect(&apos;/contact/thanks/&apos;)</span><br><span class="line">    else:</span><br><span class="line">        form = ContactForm(</span><br><span class="line">            initial=&#123;&apos;subject&apos;: &apos;默认值&apos;&#125;   # 设置form表单默认值</span><br><span class="line">        )</span><br><span class="line">    return render(request, &apos;test/contact_form.html&apos;, &#123;&apos;form&apos;: form&#125;)</span><br></pre></td></tr></table></figure>

<p>定义模板文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;联系表单&lt;/title&gt;</span><br><span class="line">        &lt;meta charset=&apos;UTF-8&apos;&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;表单测试&lt;/h1&gt;</span><br><span class="line">            &#123;% if form.errors %&#125;    &lt;!-- 接受表单对象数据 --&gt;</span><br><span class="line">            &lt;p style=&quot;color: red;&quot;&gt;</span><br><span class="line">                请处理表单错误内容&#123;&#123; form.errors|pluralize &#125;&#125;</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">            &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;field&quot;&gt;</span><br><span class="line">                    &#123;&#123; form.subject.errors &#125;&#125;</span><br><span class="line">                        &lt;label for=&quot;id_subject&quot;&gt;科目:&lt;/label&gt;</span><br><span class="line">                    &#123;&#123; form.subject &#125;&#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;field&quot;&gt;</span><br><span class="line">                    &#123;&#123; form.email.errors &#125;&#125;</span><br><span class="line">                        &lt;label for=&quot;id_email&quot;&gt;输入您的邮箱:&lt;/label&gt;</span><br><span class="line">                    &#123;&#123; form.email &#125;&#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;field&quot;&gt;</span><br><span class="line">                    &#123;&#123; form.message.errors &#125;&#125;</span><br><span class="line">                        &lt;label for=&quot;id_message&quot;&gt;消息内容:&lt;/label&gt;</span><br><span class="line">                    &#123;&#123; form.message &#125;&#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &#123;% csrf_token %&#125;    &lt;!-- 跨域处理 --&gt;</span><br><span class="line">                &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>至此一个联系表单就创建完成了</p>
<h1 id="高级视图和URL"><a href="#高级视图和URL" class="headerlink" title="高级视图和URL"></a>高级视图和URL</h1><h2 id="简化导入函数方式"><a href="#简化导入函数方式" class="headerlink" title="简化导入函数方式"></a>简化导入函数方式</h2><p>简化导入函数方式就是说我们直接导入views 模块自身，如下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 直接导入view</span><br><span class="line">from cerealsOils import views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^product_search/$&apos;, views.product_search),  # 查询页面跳转</span><br><span class="line">    url(r&apos;^search/$&apos;, views.search),    # 查询控制层</span><br></pre></td></tr></table></figure>

<h2 id="具名分组（Python具名函数的使用）"><a href="#具名分组（Python具名函数的使用）" class="headerlink" title="具名分组（Python具名函数的使用）"></a>具名分组（Python具名函数的使用）</h2><p>正则表达式分组（通过括号实现）捕获 URL 中的片段，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^reviews/2003/$&apos;, views.special_case_2003),</span><br><span class="line">    url(r&apos;^reviews/([0-9]&#123;4&#125;)/$&apos;, views.year_archive),</span><br><span class="line">    url(r&apos;^reviews/([0-9]&#123;4&#125;)/([0-9]&#123;2&#125;)/$&apos;, views.month_archive),</span><br><span class="line">    url(r&apos;^reviews/([0-9]&#123;4&#125;)/([0-9]&#123;2&#125;)/([0-9]+)/$&apos;, views.review_detail),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>如上捕获参数时，我们可以通过具名分组，为参数赋予名称：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^reviews/2003/$&apos;, views.special_case_2003),</span><br><span class="line">    url(r&apos;^reviews/(?P&lt;year&gt;[0-9]&#123;4&#125;)/$&apos;, views.year_archive),</span><br><span class="line">    url(r&apos;^reviews/(?P&lt;year&gt;[0-9]&#123;4&#125;)/(?P&lt;month&gt;[0-9]&#123;2&#125;)/$&apos;, views.month_archive),</span><br><span class="line">    url(r&apos;^reviews/(?P&lt;year&gt;[0-9]&#123;4&#125;)/(?P&lt;month&gt;[0-9]&#123;2&#125;)/(?P&lt;day&gt;[0-9]&#123;2&#125;)/$&apos;,views.review_detail),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>如上示例含义如下：</p>
<ul>
<li><p>对/reviews/2005/03/ 的请求调用views.month_archive(request, year=’2005’, month=’03’) 函数，而不是views.month_archive(request,’2005’,’03’)。</p>
</li>
<li><p>对/reviews/2003/03/03/ 的请求调用views.review_detail(request, year=’2003’, month=’03’,day=’03’) 函数。</p>
</li>
</ul>
<h3 id="匹配-分组算法"><a href="#匹配-分组算法" class="headerlink" title="匹配/分组算法"></a>匹配/分组算法</h3><p>URL 配置解析器解析正则表达式中具名分组和非具名分组所采用的算法如下：</p>
<ol>
<li><p>如果有具名分组，使用具名分组，忽略非具名分组。</p>
</li>
<li><p>否则，以位置参数传递所有非具名分组。</p>
</li>
</ol>
<p>不论如何，额外的关键字参数都会传给视图。</p>
<h2 id="URL及视图一些特性"><a href="#URL及视图一些特性" class="headerlink" title="URL及视图一些特性"></a>URL及视图一些特性</h2><ul>
<li><p>注意url的匹配规则，它不区分请求的类型，例如GET POST等，只要url一样，都交给同一个视图函数处理。</p>
</li>
<li><p>不管正则表达式匹配的是什么类型，捕获的每个参数都以普通的 Python 字符串传给视图。</p>
</li>
</ul>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^reviews/(?P&lt;year&gt;[0-9]&#123;4&#125;)/$&apos;, views.year_archive)</span><br></pre></td></tr></table></figure>

<p>虽然[0-9]{4} 只匹配字符串中的整数，但是传给views.year_archive() 视图函数的year 参数是字符串，而<br>不是整数。</p>
<ul>
<li>可以为视图函数的参数指定默认值(利用的也是Python函数的特性)</li>
</ul>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^reviews/$&apos;, views.page), # 使用默认参数</span><br><span class="line">    url(r&apos;^reviews/page(?P&lt;num&gt;[0-9]+)/$&apos;, views.page), # 这里有传值，不使用默认参数</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># 视图（在 reviews/views.py 文件中）</span><br><span class="line">def page(request, num=&quot;1&quot;):</span><br><span class="line"># 输出指定数量的书评</span><br></pre></td></tr></table></figure>

<ul>
<li>性能问题：urlpatterns 中的每个正则表达式在首次访问时编译，因此系统的速度异常得快。</li>
</ul>
<h2 id="引入其他URl配置"><a href="#引入其他URl配置" class="headerlink" title="引入其他URl配置"></a>引入其他URl配置</h2><p>urlpatterns 在任何位置都可以“引入”其他 URL 配置模块。通过这一行为可以把一些 URL 放在另一些名下。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    # ...</span><br><span class="line">    url(r&apos;^community/&apos;, include(&apos;django_website.aggregator.urls&apos;)),</span><br><span class="line">    url(r&apos;^contact/&apos;, include(&apos;django_website.contact.urls&apos;)),</span><br><span class="line">    # ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>注意，这里的正则表达式没有$（匹配字符串末尾的符号），但是末尾有斜线。Django 遇到include() 时，会把截至那一位置匹配的 URL 截断，把余下的字符串传给引入它的 URL 配置，做进一步处理。</p>
<p>可以利用这一点将公共的路径提取出来，示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">注意，url的配置可以抽取共性配置</span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^chehejia/&apos;,</span><br><span class="line">        include([ # 引入 ，引入可以引入其他URL配置模块，这里是写死的，还可以写成引入 xxx，其中xxx指的是 .py 文件，此文件中也有urlpatterns变量定义了url映射。 可以根据url的全路径匹配到引入模块的映射函数</span><br><span class="line">            url(r&apos;^add/$&apos;, views.add),</span><br><span class="line">            url(r&apos;^edit/$&apos;, views.edit),</span><br><span class="line">            url(r&apos;^delete/$&apos;, views.delete),</span><br><span class="line">            url(r&apos;^save/$&apos;, views.save),</span><br><span class="line">        ])</span><br><span class="line">    ),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>注意：通过此方式引入的URl配置，我们在父URl中使用正则捕获到的参数，是可以传递给子URl视图函数的，所以可以放心使用</p>
<h2 id="传递额外参数"><a href="#传递额外参数" class="headerlink" title="传递额外参数"></a>传递额外参数</h2><p>URL 配置允许向视图函数传递额外的参数，这些参数放在一个 Python 字典中。django.conf.urls.url() 函数的第三个参数是可选的，如果指定，应该是一个字典，指定要传给视图函数的额外关键字参数及其值。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^reviews/(?P&lt;year&gt;[0-9]&#123;4&#125;)/$&apos;,</span><br><span class="line">        views.year_archive, &#123;&apos;foo&apos;: &apos;bar&apos;&#125;  # 具名分组及设置默认参数</span><br><span class="line">    ),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>同样include()也同样适用此特性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># main.py</span><br><span class="line">from django.conf.urls import include, url</span><br><span class="line">    urlpatterns = [</span><br><span class="line">    url(r&apos;^reviews/&apos;, include(&apos;inner&apos;), &#123;&apos;reviewid&apos;: 3&#125;),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># inner.py</span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^archive/$&apos;, views.archive),</span><br><span class="line">    url(r&apos;^about/$&apos;, views.about),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="反向解析URl"><a href="#反向解析URl" class="headerlink" title="反向解析URl"></a>反向解析URl</h2><p>这个不太明白，我认为就是转发请求的时候使用，注意讨论一下</p>
<p>Django 提供了一种方案，只需在 URL 映射中设计 URL。我们为其提供 URL 配置，然后可以双向使用：</p>
<ul>
<li><p>从用户（浏览器）请求的 URL 开始，这个方案能调用正确的 Django 视图，并从 URL 中提取可能需要的参数及其值，传给视图。</p>
</li>
<li><p>从 Django 视图对应的标识以及可能传入的参数值开始，获取相应的 URL。</p>
</li>
</ul>
<p>第一点就是我们目前所讨论的处理方式。第二点称为反向解析 URL、反向匹配 URL、反向查找 URL 或 URL反转。</p>
<p>Django 在不同的层中提供了执行 URL 反转所需的工具：</p>
<ul>
<li><p>在模板中，使用url 模板标签。</p>
</li>
<li><p>在 Python 代码中，使用django.core.urlresolvers.reverse() 函数。</p>
</li>
<li><p>在处理 Django 模型实例 URL 相关的高层代码中，使用get_absolute_url() 方法。</p>
</li>
</ul>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># URl描述</span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^reviews/([0-9]&#123;4&#125;)/$&apos;, views.year_archive, name=&apos;reviews-year-archive&apos;),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># 模板中如下描述</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123;% for yearvar in year_list %&#125;</span><br><span class="line">    &lt;li&gt;&lt;a href=&quot;&#123;% url &apos;reviews-year-archive&apos; yearvar %&#125;&quot;&gt;&#123;&#123; yearvar &#125;&#125; Archive&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line"># 视图函数如下</span><br><span class="line">from django.core.urlresolvers import reverse</span><br><span class="line">from django.http import HttpResponseRedirect</span><br><span class="line"></span><br><span class="line">def redirect_to_year(request):</span><br><span class="line">    # ...</span><br><span class="line">    year = 2012</span><br><span class="line">    # ...</span><br><span class="line">    return HttpResponseRedirect(reverse(&apos;reviews-year-archive&apos;, args=(year,)))</span><br></pre></td></tr></table></figure>

<h2 id="URl命名空间"><a href="#URl命名空间" class="headerlink" title="URl命名空间"></a>URl命名空间</h2><p>URL 命名空间在反转具名 URL 模式时具有唯一确定性，即便不同的应用使用相同的名称也不怕。</p>
<p>正确使用 URL 命名空间的 Django 应用程序可以在同一个网站中多次部署。例如，django.contrib.admin 中有个AdminSite 类，可以轻易部署多个管理后台。URL 命名空间分为两部分，而且都是字符串：</p>
<ol>
<li><p>应用命名空间。指明应用的名称。一个应用的每个实例都具有相同的应用命名空间。例如，你可能猜到了，Django 管理后台的应用命名空间是admin。</p>
</li>
<li><p>实例命名空间。标识具体的应用程序实例。实例命名空间在整个项目范围内应该是唯一的。不过，实例命名空间可以与应用命名空间相同，供应用的默认实例使用。例如，Django 管理后台实例的默认实例命名空间是admin</p>
</li>
</ol>
<p>命名空间中的 URL 使用: 运算符指定。例如，管理后台的主页使用  <strong>admin:index</strong>  引用。其中，admin 是命名空间，index 是 URL 的名称。</p>
<p>命名空间还可以嵌套。members:reviews:index 在命名空间members 中查找命名空间reviews，再在里面查找index URL。</p>
<h3 id="反转命名空间的URl的步骤"><a href="#反转命名空间的URl的步骤" class="headerlink" title="反转命名空间的URl的步骤"></a>反转命名空间的URl的步骤</h3><ol>
<li><p>首先，Django 查找有没有匹配的应用命名空间（这里的reviews）。为此，会产出那个应用的实例列表。</p>
</li>
<li><p>如果有这么一个应用实例，Django 返回它的 URL 解析程序。当前应用可以通过请求的一个属性指定。预期有多个部署实例的应用应该在处理的请求上设定current_app 属性。</p>
</li>
<li><p>当前应用也可以手动指定，方法是作为参数传给reverse() 函数。</p>
</li>
<li><p>如果没有当前应用，Django 查找默认的应用实例。默认应用实例是指实例命名空间与应用命名空间匹配的实例（在这里是指名为reviews 的reviews 实例）。</p>
</li>
<li><p>如果没有默认的应用实例，Django 选中最后部署的应用实例，而不管实例的名称。</p>
</li>
<li><p>如果第 1 步找不到匹配的应用命名空间，Django 直接把它视作实例命名空间查找。</p>
</li>
</ol>
<h3 id="URL-命名空间和引入的-URL-配置示例"><a href="#URL-命名空间和引入的-URL-配置示例" class="headerlink" title="URL 命名空间和引入的 URL 配置示例"></a>URL 命名空间和引入的 URL 配置示例</h3><p>把引入的 URL 配置放入命名空间中有两种方式。</p>
<p>第一种，在 URL 模式中为include() 提供应用和实例命名空间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^reviews/&apos;, include(&apos;reviews.urls&apos;, namespace=&apos;author-reviews&apos;, app_name=&apos;reviews&apos;))</span><br></pre></td></tr></table></figure>

<p>上述示例把reviews.urls 中定义的 URL 放在应用命名空间reviews 中，放在实例命名空间author-reviews中。</p>
<p>第二种，引入包含命名空间数据的对象。如果使用include() 引入一组url() 实例，那个对象中的 URL 都添加到全局命名空间中。然而，include() 的参数还可以是一个三元素元组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">reviews_patterns = [</span><br><span class="line">    url(r&apos;^$&apos;, views.IndexView.as_view(), name=&apos;index&apos;),</span><br><span class="line">    url(r&apos;^(?P&lt;pk&gt;\d+)/$&apos;, views.DetailView.as_view(), name=&apos;detail&apos;),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">url(r&apos;^reviews/&apos;, include((reviews_patterns, &apos;reviews&apos;, &apos;author-reviews&apos;))),</span><br></pre></td></tr></table></figure>

<p>上述示例把指定的 URL 模式引入指定的应用和实例命名空间中。</p>
<p>记得要把一个元组传给include()。如果直接传入三个参数，例如include(reviews_patterns, ‘reviews’,’author-reviews’)，Django 不会抛出错误，但是根据include() 的签名，’reviews’ 是实例命名空间，’author-reviews’ 是应用命名空间，而正确的顺序应该反过来。</p>
<h1 id="高级模板技术"><a href="#高级模板技术" class="headerlink" title="高级模板技术"></a>高级模板技术</h1><h2 id="RequestContext和上下文处理器"><a href="#RequestContext和上下文处理器" class="headerlink" title="RequestContext和上下文处理器"></a>RequestContext和上下文处理器</h2><p>模板要在上下文中渲染。上下文是django.template.Context 的实例，不过 Django 还提供了一个子类，django.template.RequestContext，其行为稍有不同。</p>
<p>RequestContext 默认为模板上下文添加很多变量，例如HttpRequest 对象或当前登录用户的信息，例如我们在视图函数中获取到的request对象，它就是Djongo为我们提供的上下文处理器，我们可以在此处理器中获取很多参数:</p>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def view_1(request):</span><br><span class="line">    # ...</span><br><span class="line">    t = loader.get_template(&apos;template1.html&apos;)</span><br><span class="line">    c = RequestContext(request, &#123;&apos;message&apos;: &apos;I am view 1.&apos;&#125;, processors=[custom_proc])</span><br><span class="line">    return t.render(c)</span><br></pre></td></tr></table></figure>

<p>上下文处理器使用示例，提供公共的上下文处理器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 定义一个上下文处理器，提供 &apos;app&apos;、&apos;user&apos; 和 &apos;ip_address&apos;，可以在处理器中为多个请求提供共同的必要的上下文</span><br><span class="line"># 注意：上下文处理器必须返回一个字典</span><br><span class="line"># 自定义上下文处理器一般放在单独项目或者项目下的context_processors.py中</span><br><span class="line">def custom_proc(request):</span><br><span class="line">    return &#123;</span><br><span class="line">        &apos;app&apos;: &apos;我的上下文测试&apos;,</span><br><span class="line">        &apos;user&apos;: request.user,</span><br><span class="line">        &apos;ip_address&apos;: request.META[&apos;REMOTE_ADDR&apos;]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"># 引用上下文处理器直接返回给模板进行渲染</span><br><span class="line"># 注意processors函数的参数，第一个必须是request对象，第二个是可选的上下文处理器列表或元组</span><br><span class="line">def view_1(request):</span><br><span class="line">    return render(request, &apos;template1.html&apos;,</span><br><span class="line">        &#123;&apos;message&apos;: &apos;消息1&apos;&#125;,</span><br><span class="line">            context_instance=RequestContext(</span><br><span class="line">            request, processors=[custom_proc]</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"># 与上述一致，公用上下文处理器</span><br><span class="line">def view_2(request):</span><br><span class="line">    return render(request, &apos;template2.html&apos;,</span><br><span class="line">        &#123;&apos;message&apos;: &apos;消息2&apos;&#125;,</span><br><span class="line">            context_instance=RequestContext(</span><br><span class="line">            request, processors=[custom_proc]</span><br><span class="line">        )</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h2 id="Djongo提供的上下文处理器"><a href="#Djongo提供的上下文处理器" class="headerlink" title="Djongo提供的上下文处理器"></a>Djongo提供的上下文处理器</h2><p>在settings文件中，我们来逐一说明Djongo提供的上下文处理器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&apos;OPTIONS&apos;: &#123;</span><br><span class="line">    # 默认的处理器上下文</span><br><span class="line">    &apos;context_processors&apos;: [</span><br><span class="line">        # 启用这个处理器后，RequestContext 中将包含下面两个变量</span><br><span class="line">        # debug：True。可以在模板中测试是否在DEBUG 模式中。</span><br><span class="line">        # sql_queries：&#123;&apos;sql&apos;: …, &apos;time&apos;: …&#125; 字典构成的列表，表示处理请求的过程中执行的 SQL 查询及其用时。列表中的值按查询的执行顺序排列，在访问时惰性生成</span><br><span class="line">        &apos;django.template.context_processors.debug&apos;,</span><br><span class="line"></span><br><span class="line">        # 启用这个处理器后，RequestContext 中将包含request 变量，它的值是当前的HttpRequest 对象</span><br><span class="line">        &apos;django.template.context_processors.request&apos;,</span><br><span class="line"></span><br><span class="line">        # 启用此处理器后将包含：</span><br><span class="line">        # user：auth.User 的实例，表示当前登录的用户（如未登录，是AnonymousUser 实例）。</span><br><span class="line">        # perms：django.contrib.auth.context_processors.PermWrapper 实例，表示当前登录用户拥有的权限。</span><br><span class="line">        &apos;django.contrib.auth.context_processors.auth&apos;,</span><br><span class="line"></span><br><span class="line">        # 启用这个处理器后，RequestContext 中将包含下面两个变量：</span><br><span class="line">        # messages：消息框架设定的消息列表（里面的值是字符串）</span><br><span class="line">        # DEFAULT_MESSAGE_LEVELS：消息等级名称到数字值的映射</span><br><span class="line">        &apos;django.contrib.messages.context_processors.messages&apos;,</span><br><span class="line"></span><br><span class="line">        # 非默认，启用后将包含：</span><br><span class="line">        # LANGUAGES：LANGUAGES 设置的值</span><br><span class="line">        # LANGUAGE_CODE：如果request.LANGUAGE_CODE 存在，返回它的值；否则返回LANGUAGE_CODE 设置的值</span><br><span class="line">        # django.template.context_processors.i18n</span><br><span class="line"></span><br><span class="line">        # 非默认，启用这个处理器后，RequestContext 中将包含MEDIA_URL 变量，提供MEDIA_URL 设置的值</span><br><span class="line">        # django.template.context_processors.media</span><br><span class="line"></span><br><span class="line">        # 非默认，启用这个处理程序后，RequestContext 中将包含STATIC_URL 变量，提供STATIC_URL 设置的值</span><br><span class="line">        # jango.template.context_processors.static</span><br><span class="line"></span><br><span class="line">        # 非默认，这个处理器添加一个令牌，供csrf_token 模板标签使用，用于防范跨站请求伪造，（暂时不清楚具体意思）</span><br><span class="line">        # django.template.context_processors.csrf</span><br><span class="line">    ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="模板加载内部机制"><a href="#模板加载内部机制" class="headerlink" title="模板加载内部机制"></a>模板加载内部机制</h2><h3 id="DIRS-选项"><a href="#DIRS-选项" class="headerlink" title="DIRS 选项"></a>DIRS 选项</h3><p>告诉 Django 模板目录有哪些的方法是使用设置文件中TEMPLATES 设置的DIRS 选项，或者是Engine 的dirs 参数。这个选项的值是一个字符串列表，包含指向模板目录的完整路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        &apos;BACKEND&apos;: &apos;django.template.backends.django.DjangoTemplates&apos;,</span><br><span class="line">        &apos;DIRS&apos;: [</span><br><span class="line">            &apos;/home/html/templates/lawrence.com&apos;,</span><br><span class="line">            &apos;/home/html/templates/default&apos;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>模板可以放在任何位置，只要 Web 服务器有权限读取目录及里面的模板即可。模板的扩展名不限，可以是.html 或.txt，甚至可以没有。注意，这里的路径应该使用 Unix 风格的正斜线，即便在 Windows 中也是如此。</p>
<h3 id="加载器类型说明"><a href="#加载器类型说明" class="headerlink" title="加载器类型说明"></a>加载器类型说明</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 加载器</span><br><span class="line"># 默认使用 ilesystem.Loader 文件系统加载器，如果不设定DIRS 选项，这个加载器找不到任何模板。</span><br><span class="line"># DIRS 定义一个目录列表，模板引擎按顺序在里面查找模板源文件。</span><br><span class="line"># 当前设置表示在项目根目录中放一些主模板，模板目录不一定非得叫&apos;templates&apos;，可以自定义</span><br><span class="line">&apos;DIRS&apos;: [os.path.join(BASE_DIR, &apos;templates&apos;)],</span><br><span class="line"></span><br><span class="line"># 还有应用目录加载器 pp_directories.Loader</span><br><span class="line"># INSTALLED_APPS = [&apos;myproject.reviews&apos;, &apos;myproject.music&apos;]</span><br><span class="line"># 从文件系统中的 Django 应用里加载模板。这个加载器在INSTALLED_APPS 列出的各个应用中查找templates 子目录。如果找到，Django 在其中查找模板。</span><br><span class="line"># 这意味着，应用可以自带模板。通过这一行为，便于分发带默认模板的 Django 应用。例此加载器会在设置的文件夹中顺序的加载模板，最先找到的被加载，所以设置顺序很重要</span><br><span class="line"></span><br><span class="line"># 还有一些其他加载器，默认是禁用的，自行了解</span><br></pre></td></tr></table></figure>

<h1 id="Django模型的高级用法"><a href="#Django模型的高级用法" class="headerlink" title="Django模型的高级用法"></a>Django模型的高级用法</h1><h2 id="新增和修改对象"><a href="#新增和修改对象" class="headerlink" title="新增和修改对象"></a>新增和修改对象</h2><p>save和create方法，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">m01 = Manufacturers(name=&apos;金龙鱼&apos;，address=&apos;铁岭&apos;, city=&apos;大连&apos;, province=&apos;沈阳&apos;, website=&apos;www.xmy.com&apos;)</span><br><span class="line"># save方法保存</span><br><span class="line">m01.save()</span><br><span class="line"></span><br><span class="line"># create方法保存</span><br><span class="line">m02 = Manufacturers.objects.create(name=&apos;金龙鱼&apos;，address=&apos;铁岭&apos;, city=&apos;大连&apos;, province=&apos;沈阳&apos;, website=&apos;www.xmy.com&apos;)</span><br><span class="line"></span><br><span class="line"># 当数据被保存后，及对象ID值是有的，直接再次调用save方法，就是修改对象，注意这里是全字段修改</span><br><span class="line">m02.name = &apos;鲁花&apos;</span><br><span class="line">m02.save()</span><br><span class="line"></span><br><span class="line"># 一个语句更新一个对象</span><br><span class="line">Manufacturers.objects.get(name=&apos;金龙鱼&apos;).save(city=&apos;黑龙江&apos;)</span><br><span class="line"></span><br><span class="line"># 一个语句中更新多条数据</span><br><span class="line">Manufacturers.objects.filter(name=&apos;金龙鱼&apos;).update(city=&apos;黑龙江&apos;)</span><br></pre></td></tr></table></figure>

<h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><p>all、filter、get方法等，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 获取所有数据</span><br><span class="line">Manufacturers.objects.all()</span><br><span class="line"></span><br><span class="line"># 根据条件获取部分数据</span><br><span class="line">Manufacturers.objects.filter(name=&apos;金龙鱼&apos;)</span><br><span class="line"></span><br><span class="line"># 根据多个条件获取部分数据</span><br><span class="line">Manufacturers.objects.filter(name=&apos;金龙鱼&apos;, address=&apos;铁岭&apos;)</span><br><span class="line"></span><br><span class="line"># 类似SQL使用like语句过滤获取部分数据，字段加两个下划线，接contains</span><br><span class="line">Manufacturers.objects.filter(name__contains=&apos;金&apos;)</span><br><span class="line"></span><br><span class="line"># 获取单个数据，此方法返回的就不是列表了，而是单条数据，如果查询出多条数据或者没有查询出数据，会抛出异常</span><br><span class="line">Manufacturers.objects.get(website=&apos;www.xmy.com&apos;)</span><br></pre></td></tr></table></figure>

<h2 id="排序数据"><a href="#排序数据" class="headerlink" title="排序数据"></a>排序数据</h2><p>order_by方法，具体如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 根据name排序，正向</span><br><span class="line">Manufacturers.objects.order_by(&apos;name&apos;)</span><br><span class="line"></span><br><span class="line"># 根据多个字段排序</span><br><span class="line">Manufacturers.objects.order_by(&apos;name&apos;, &apos;province&apos;)</span><br><span class="line"></span><br><span class="line"># 反向排序，方法是在字段名称前面加上“-”（减号）</span><br><span class="line">Manufacturers.objects.order_by(&apos;-name&apos;)</span><br></pre></td></tr></table></figure>

<h2 id="链式查找"><a href="#链式查找" class="headerlink" title="链式查找"></a>链式查找</h2><p>既过滤加排序，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Manufacturers.objects.filter(name=&apos;金龙鱼&apos;).order_by(&apos;-name&apos;)</span><br></pre></td></tr></table></figure>

<h2 id="切片数据"><a href="#切片数据" class="headerlink" title="切片数据"></a>切片数据</h2><p>及传统上理解的分页查找，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 返回查询出的第一条数据</span><br><span class="line">Manufacturers.objects.filter(name=&apos;金龙鱼&apos;)[0]</span><br><span class="line"></span><br><span class="line"># 分页查询，底层使用的是Mysql的Limit函数</span><br><span class="line">Manufacturers.objects.filter(name=&apos;金龙鱼&apos;)[0, 10]</span><br></pre></td></tr></table></figure>

<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><p>delete方法，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 删除一条数据</span><br><span class="line">Manufacturers.objects.get(name=&apos;金龙鱼&apos;).delete()</span><br><span class="line"></span><br><span class="line"># 删除多条数据</span><br><span class="line">Manufacturers.objects.filter(name=&apos;金龙鱼&apos;).delete()</span><br><span class="line"></span><br><span class="line"># 删除全部数据</span><br><span class="line">Manufacturers.objects.all().delete()</span><br></pre></td></tr></table></figure>

<h2 id="访问外键数据"><a href="#访问外键数据" class="headerlink" title="访问外键数据"></a>访问外键数据</h2><p>根据外键查询出关联的对象，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 一对一关联</span><br><span class="line">manufacturers = Product.objects.get(title=&apos;小米&apos;).manufacturers</span><br><span class="line">manufacturersName = Product.objects.get(title=&apos;小米&apos;).manufacturers.name</span><br></pre></td></tr></table></figure>

<h2 id="访问多对多数据"><a href="#访问多对多数据" class="headerlink" title="访问多对多数据"></a>访问多对多数据</h2><p>多对多关联数据获取如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 获取所有关联</span><br><span class="line">vender = Product.objects.get(title=&apos;小米&apos;).vender.all()</span><br><span class="line"></span><br><span class="line"># 过滤多对多数据</span><br><span class="line">vender = Product.objects.get(title=&apos;小米&apos;).vender.filter(name=&apos;供应商&apos;)</span><br><span class="line"></span><br><span class="line"># 反过来，查看经销商经销的所有产品，字段加 _set</span><br><span class="line">Vender.objects.get(name=&apos;供应商&apos;).product_set.all()</span><br><span class="line"></span><br><span class="line">count = Product.vender.count()</span><br></pre></td></tr></table></figure>

<h2 id="管理器"><a href="#管理器" class="headerlink" title="管理器"></a>管理器</h2><p>在Book.objects.all() 语句中，objects 是个特殊的属性，我们通过它查询数据库，这是模型的管理器（manager）。现在，我们要深入说明管理器的作用和用法。</p>
<p>添加额外的自定义管理器，修改模型如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 自定义模型管理器</span><br><span class="line">class MyProductManager(models.Manager):</span><br><span class="line">    # 覆盖的get_queryset() 返回的是一个QuerySet 对象，它对应着我们管理器的all()方法</span><br><span class="line">    def get_queryset(self):</span><br><span class="line">        return super(MyProductManager, self).get_queryset().filter(name=&apos;大米&apos;)</span><br><span class="line"></span><br><span class="line"># 产品</span><br><span class="line">class Product(models.Model):</span><br><span class="line">    title = models.CharField(max_length=100, verbose_name=&apos;产品名称&apos;)</span><br><span class="line">    vender = models.ManyToManyField(Vender, verbose_name=&apos;经销商&apos;)</span><br><span class="line">    manufacturers = models.ForeignKey(Manufacturers, verbose_name=&apos;厂家&apos;)</span><br><span class="line">    product_date = models.DateField(verbose_name=&apos;生产日期&apos;)</span><br><span class="line">    # fields = (&apos;title&apos;, &apos;product_date&apos;, &apos;vender&apos;, &apos;manufacturers&apos;)</span><br><span class="line"></span><br><span class="line">    # 我们明确地把objects 设为一个普通的Manager 示例，如若不然，唯一可用的管理器将是dahl_objects</span><br><span class="line">    objects = models.Manager() # 默认的管理器</span><br><span class="line">    my_objects = MyProductManager() # 专门查询 产品名称为大米 的管理器</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return u&apos;%s %s&apos; % (self.title, self.product_date)</span><br><span class="line"></span><br><span class="line">    # 任何模型都可以使用Meta 类指定多个针对所在模型的选项。</span><br><span class="line">    class Meta:</span><br><span class="line">        ordering = [&apos;product_date&apos;]</span><br></pre></td></tr></table></figure>

<p>下面是使用上述自定义管理器示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># get_queryset() 返回的是一个QuerySet 对象，因此可以在其上调用filter()、exclude() 和其他所有QuerySet 支持的方法</span><br><span class="line">Product.my_objects.all()</span><br><span class="line">Product.my_objects.filter(title=&apos;Matilda&apos;)</span><br><span class="line">Product.my_objects.count()</span><br></pre></td></tr></table></figure>

<p>如果需要，我们可以在同一个模型上使用多个管理器。</p>
<h2 id="模型方法"><a href="#模型方法" class="headerlink" title="模型方法"></a>模型方法</h2><p>模型方法就是为Model提供一些方法，我们调用这些方法的时候能处理一些我们想要的逻辑。</p>
<p>模型为我们自动提供的常用方法有如下：</p>
<ul>
<li><p><strong>str</strong>()。这是 Python 的一个“魔法方法”，返回对象的 Unicode 表示形式。需要以普通的字符串显示模型实例时，Python 和 Django 会调用这个方法。尤其要注意，在交互式控制台或管理后台中显示对象调用的都是这个方法。这个方法一定要自定义，因为默认的实现没什么用。</p>
</li>
<li><p>get_absolute_url()。这个方法告诉 Django 如何计算一个对象的 URL。Django 在管理后台和需要生成对象的 URL 时调用这个方法。具有唯一标识的 URL 的对象都要定义这个方法。</p>
</li>
</ul>
<p>模型方法大多可以被直接覆盖，最常见的就是覆盖<strong>str</strong>()方法</p>
<p>一下演示覆盖预定义的模型方法，是针对数据库执行行为来覆盖的，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 定义Blog模型，覆盖它的save方法，如下定义某些情况下不允许保存</span><br><span class="line">class Blog(models.Model):</span><br><span class="line"></span><br><span class="line">    name = models.CharField(max_length=100)</span><br><span class="line">    tagline = models.TextField()</span><br><span class="line"></span><br><span class="line">    def save(self, *args, **kwargs):</span><br><span class="line">        if self.name == &quot;Yoko Ono&apos;s blog&quot;:</span><br><span class="line">            return # Yoko 肯定不会开博客的！</span><br><span class="line">        else:</span><br><span class="line">            super(Blog, self).save(*args, **kwargs) # 调用“真正的”save () 方法</span><br></pre></td></tr></table></figure>

<h2 id="执行原始SQL"><a href="#执行原始SQL" class="headerlink" title="执行原始SQL"></a>执行原始SQL</h2><p>模型的查询 API 不够用时，可以编写原始 SQL。Django 为执行原始 SQL 查询提供了两种方式：使用Manager.raw() 执行，返回模型实例集合；或者完全不用模型层，直接执行自定义SQL</p>
<p>第一种方式执行示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 基本查询分页</span><br><span class="line">Product.objects.raw(&apos;SELECT * FROM CEREALSOILS_PRODUCT LIMIT 0, 5&apos;)</span><br><span class="line"></span><br><span class="line"># 当我们定义的模型字段名称与数据库字段名称不一致时，可以通过AS将字段对应起来</span><br><span class="line">Product.objects.raw(&apos;SELECT product_name as name FROM CEREALSOILS_PRODUCT&apos;)</span><br><span class="line"></span><br><span class="line"># 延期模型字段</span><br><span class="line"># 注意：指定查询字段的时候，必须要包含主键字段</span><br><span class="line">p = Product.objects.raw(&apos;SELECT id, title FROM CEREALSOILS_PRODUCT&apos;)</span><br><span class="line">title = p.title # 上述执行取出的数</span><br><span class="line">product_date = p.product_date   # 又执行了一次SQL来取出的此字段的值</span><br><span class="line"></span><br><span class="line"># 为raw传递参数，注意，这里是防注入的用法，参数写在raw方法内才有防注入的作用</span><br><span class="line"># 注意：Djongo中的占位符是  %s ，而不是 ?</span><br><span class="line"># 查询中有 % ，则需要写两个 %</span><br><span class="line">title = &apos;大米&apos;</span><br><span class="line">pa = Product.objects.raw(&apos;SELECT * FROM CEREALSOILS_PRODUCT where title = %s&apos;, title)</span><br><span class="line">p9 = Product.objects.raw(&apos;SELECT * FROM cerealsOils_product where title like %s LIMIT 0, 5&apos;, [&apos;%米%&apos;])</span><br></pre></td></tr></table></figure>

<p>第二种方式执行示例：</p>
<p>django.db.connection 对象表示默认的数据库连接。若想使用这个数据库连接，调用connection.cursor()，然后，调用cursor.execute(sql, [params]) 执行 SQL，再调用cursor.fetchone() 或cursor.fetchall() 返回所得的行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">from django.db import connection</span><br><span class="line"></span><br><span class="line">def my_custom_sql(self):</span><br><span class="line">    cursor = connection.cursor()</span><br><span class="line">    cursor.execute(&quot;UPDATE bar SET foo = 1 WHERE baz = %s&quot;, [self.baz])</span><br><span class="line">    cursor.execute(&quot;SELECT foo FROM bar WHERE baz = %s&quot;, [self.baz])</span><br><span class="line">    row = cursor.fetchone()</span><br><span class="line">    return row</span><br><span class="line"></span><br><span class="line"># 当需要连接多个数据库时，可以获取指定的数据库连接</span><br><span class="line">cursor = connections[&apos;my_db_alias&apos;].cursor()</span><br><span class="line"></span><br><span class="line"># 连接和游标（类似于Java中 Try-with-resouce）</span><br><span class="line">with connection.cursor() as c:</span><br><span class="line">    c.execute(...)</span><br><span class="line">等效于：</span><br><span class="line">c = connection.cursor()</span><br><span class="line">try:</span><br><span class="line">    c.execute(...)</span><br><span class="line">finally:</span><br><span class="line">    c.close()</span><br><span class="line"></span><br><span class="line"># 查询数据，只返回结果没有字段名称映射</span><br><span class="line">cursor = connection.cursor()</span><br><span class="line">cursor.execute(&quot;SELECT id, title FROM cerealsOils_product&quot;)</span><br><span class="line">row01 = cursor.fetchone()</span><br><span class="line">row02 = cursor.fetchone()</span><br><span class="line">print(row01)</span><br><span class="line">print(row02)</span><br><span class="line"></span><br><span class="line"># 查询数据，有字段名称映射</span><br><span class="line">cursor01 = connection.cursor()</span><br><span class="line">cursor01.execute(&quot;SELECT id, title FROM cerealsOils_product&quot;)</span><br><span class="line">desc = cursor01.description</span><br><span class="line">dict(zip([col[0] for col in desc], row))</span><br><span class="line">for row in cursor01.fetchall():</span><br><span class="line">    print(row)</span><br></pre></td></tr></table></figure>
            <div class="post-copyright">
    <div class="content">
        <p>最后更新： 2019年08月11日 13:40</p>
        <p>原始链接： <a class="post-url" href="/2019/08/04/Django-02/" title="Django-02">https://jjw-story.github.io/2019/08/04/Django-02/</a></p>
        <footer>
            <a href="https://jjw-story.github.io">
                <img src="/images/logo.png" alt="JJW">
                JJW
            </a>
        </footer>
    </div>
</div>

      
        
            
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;">赏</a>
</div>

<div id="reward" class="post-modal reward-lay">
    <a class="close" href="javascript:;" id="reward-close">×</a>
    <span class="reward-title">
        <i class="icon icon-quote-left"></i>
        请我吃糖~
        <i class="icon icon-quote-right"></i>
    </span>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/images/wechat_code.jpg" alt="打赏二维码">
        </div>
        <div class="reward-select">
            
            <label class="reward-select-item checked" data-id="wechat" data-wechat="/images/wechat_code.jpg">
                <img class="reward-select-item-wechat" src="/images/wechat.png" alt="微信">
            </label>
            
            
            <label class="reward-select-item" data-id="alipay" data-alipay="/images/alipay_code.jpg">
                <img class="reward-select-item-alipay" src="/images/alipay.png" alt="支付宝">
            </label>
            
        </div>
    </div>
</div>


        
    </div>
    <footer class="article-footer">
        
        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://jjw-story.github.io/2019/08/04/Django-02/&title=《Django-02》 — JJW-STORY&pic=/images/blogs/python.jpg" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://jjw-story.github.io/2019/08/04/Django-02/&title=《Django-02》 — JJW-STORY&source=" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://jjw-story.github.io/2019/08/04/Django-02/" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Django-02》 — JJW-STORY&url=https://jjw-story.github.io/2019/08/04/Django-02/&via=https://jjw-story.github.io" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://jjw-story.github.io/2019/08/04/Django-02/" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://jjw-story.github.io/2019/08/04/Django-02/" alt="微信分享二维码">
</div>

<div class="mask"></div>

        
        <ul class="article-footer-menu">
            
            
  <li class="article-footer-tags">
    <i class="fa fa-tags"></i>
      
    <a href="/tags/Python/" class="color2">Python</a>
      
    <a href="/tags/Django/" class="color2">Django</a>
      
  </li>

        </ul>
        
    </footer>
  </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Djongo表单"><span class="post-toc-text">Djongo表单</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#从请求对象中获取数据"><span class="post-toc-text">从请求对象中获取数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简单的表单使用示例"><span class="post-toc-text">简单的表单使用示例</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#联系表单"><span class="post-toc-text">联系表单</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#高级视图和URL"><span class="post-toc-text">高级视图和URL</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简化导入函数方式"><span class="post-toc-text">简化导入函数方式</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#具名分组（Python具名函数的使用）"><span class="post-toc-text">具名分组（Python具名函数的使用）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#匹配-分组算法"><span class="post-toc-text">匹配/分组算法</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#URL及视图一些特性"><span class="post-toc-text">URL及视图一些特性</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#引入其他URl配置"><span class="post-toc-text">引入其他URl配置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#传递额外参数"><span class="post-toc-text">传递额外参数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#反向解析URl"><span class="post-toc-text">反向解析URl</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#URl命名空间"><span class="post-toc-text">URl命名空间</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#反转命名空间的URl的步骤"><span class="post-toc-text">反转命名空间的URl的步骤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#URL-命名空间和引入的-URL-配置示例"><span class="post-toc-text">URL 命名空间和引入的 URL 配置示例</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#高级模板技术"><span class="post-toc-text">高级模板技术</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#RequestContext和上下文处理器"><span class="post-toc-text">RequestContext和上下文处理器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Djongo提供的上下文处理器"><span class="post-toc-text">Djongo提供的上下文处理器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#模板加载内部机制"><span class="post-toc-text">模板加载内部机制</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#DIRS-选项"><span class="post-toc-text">DIRS 选项</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#加载器类型说明"><span class="post-toc-text">加载器类型说明</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Django模型的高级用法"><span class="post-toc-text">Django模型的高级用法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#新增和修改对象"><span class="post-toc-text">新增和修改对象</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#查询数据"><span class="post-toc-text">查询数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#排序数据"><span class="post-toc-text">排序数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#链式查找"><span class="post-toc-text">链式查找</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#切片数据"><span class="post-toc-text">切片数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#删除数据"><span class="post-toc-text">删除数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#访问外键数据"><span class="post-toc-text">访问外键数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#访问多对多数据"><span class="post-toc-text">访问多对多数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#管理器"><span class="post-toc-text">管理器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#模型方法"><span class="post-toc-text">模型方法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#执行原始SQL"><span class="post-toc-text">执行原始SQL</span></a></li></ol></li></ol>
        </nav>
    </aside>
    

<nav id="article-nav">
  
    <a href="/2019/08/08/网络状态查看/" id="article-nav-newer" class="article-nav-link-wrap">

      <span class="article-nav-title">
        <i class="fa fa-hand-o-left" aria-hidden="true"></i>
        
          网络状态查看
        
      </span>
    </a>
  
  
    <a href="/2019/08/04/Django-01/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">Django-01</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>



    
</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2021 JJW<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "https://jjw-story.github.io",
      animate: true,
      isHome: false,
      share: true,
      reward: 1
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/Docker/">Docker</a><a class="category-link" href="/categories/Flink/">Flink</a><a class="category-link" href="/categories/IDEA/">IDEA</a><a class="category-link" href="/categories/Kubernetes/">Kubernetes</a><a class="category-link" href="/categories/Lamda/">Lamda</a><a class="category-link" href="/categories/Linux/">Linux</a><a class="category-link" href="/categories/MQ/">MQ</a><a class="category-link" href="/categories/MySQL/">MySQL</a><a class="category-link" href="/categories/Python/">Python</a><a class="category-link" href="/categories/Scala/">Scala</a><a class="category-link" href="/categories/Spark/">Spark</a><a class="category-link" href="/categories/设计模式/">设计模式</a><a class="category-link" href="/categories/高效员工起航训练营/">高效员工起航训练营</a>
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/tags/Compose/" style="font-size: 10px;">Compose</a> <a href="/tags/Design/" style="font-size: 15px;">Design</a> <a href="/tags/Django/" style="font-size: 13.33px;">Django</a> <a href="/tags/Docker/" style="font-size: 18.33px;">Docker</a> <a href="/tags/Elasticsearch核心技术/" style="font-size: 10px;">Elasticsearch核心技术</a> <a href="/tags/Flink/" style="font-size: 13.33px;">Flink</a> <a href="/tags/Flink-Storm-SparkStream对比/" style="font-size: 10px;">Flink Storm SparkStream对比</a> <a href="/tags/IDEA/" style="font-size: 10px;">IDEA</a> <a href="/tags/Kebernetes/" style="font-size: 10px;">Kebernetes</a> <a href="/tags/Kubernetes/" style="font-size: 10px;">Kubernetes</a> <a href="/tags/Lamda/" style="font-size: 10px;">Lamda</a> <a href="/tags/MQ/" style="font-size: 10px;">MQ</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Network/" style="font-size: 10px;">Network</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Python基础/" style="font-size: 10px;">Python基础</a> <a href="/tags/Scala/" style="font-size: 11.67px;">Scala</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/Spark/" style="font-size: 10px;">Spark</a> <a href="/tags/Swarm/" style="font-size: 10px;">Swarm</a> <a href="/tags/command/" style="font-size: 20px;">command</a> <a href="/tags/overview/" style="font-size: 10px;">overview</a> <a href="/tags/su-sudo/" style="font-size: 10px;">su-sudo</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/入门/" style="font-size: 16.67px;">入门</a> <a href="/tags/内存与磁盘管理/" style="font-size: 10px;">内存与磁盘管理</a> <a href="/tags/创建型设计模式/" style="font-size: 10px;">创建型设计模式</a> <a href="/tags/原则-规范-重构/" style="font-size: 10px;">原则-规范-重构</a> <a href="/tags/基础入门/" style="font-size: 10px;">基础入门</a> <a href="/tags/实践一/" style="font-size: 10px;">实践一</a> <a href="/tags/实践三/" style="font-size: 10px;">实践三</a> <a href="/tags/实践二/" style="font-size: 10px;">实践二</a> <a href="/tags/帮助命令/" style="font-size: 10px;">帮助命令</a> <a href="/tags/打包压缩与解压缩/" style="font-size: 10px;">打包压缩与解压缩</a> <a href="/tags/数据持久化/" style="font-size: 10px;">数据持久化</a> <a href="/tags/文件及目录权限/" style="font-size: 10px;">文件及目录权限</a> <a href="/tags/文件查看命令/" style="font-size: 10px;">文件查看命令</a> <a href="/tags/文件管理命令/" style="font-size: 10px;">文件管理命令</a> <a href="/tags/文本查看命令/" style="font-size: 10px;">文本查看命令</a> <a href="/tags/用户和权限管理/" style="font-size: 10px;">用户和权限管理</a> <a href="/tags/结构型设计模式/" style="font-size: 10px;">结构型设计模式</a> <a href="/tags/网络管理/" style="font-size: 15px;">网络管理</a> <a href="/tags/行为型设计模式/" style="font-size: 10px;">行为型设计模式</a> <a href="/tags/语法/" style="font-size: 10px;">语法</a> <a href="/tags/软件包管理器和内核升级/" style="font-size: 10px;">软件包管理器和内核升级</a> <a href="/tags/运行时架构/" style="font-size: 10px;">运行时架构</a> <a href="/tags/进程管理/" style="font-size: 10px;">进程管理</a> <a href="/tags/进阶/" style="font-size: 10px;">进阶</a> <a href="/tags/逻辑卷管理/" style="font-size: 10px;">逻辑卷管理</a> <a href="/tags/镜像的构建和发布及容器操作/" style="font-size: 10px;">镜像的构建和发布及容器操作</a> <a href="/tags/高效员工起航训练营/" style="font-size: 10px;">高效员工起航训练营</a> <a href="/tags/高阶/" style="font-size: 10px;">高阶</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a  href="/">
                    <i class="fa fa-home"></i><span>Home</span>
                </a>
            </li>
            
            <li>
                <a  href="/archives">
                    <i class="fa fa-archive"></i><span>Archives</span>
                </a>
            </li>
            
            <li>
                <a  href="/about">
                    <i class="fa fa-user"></i><span>About</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/tags/Compose/" style="font-size: 10px;">Compose</a> <a href="/tags/Design/" style="font-size: 15px;">Design</a> <a href="/tags/Django/" style="font-size: 13.33px;">Django</a> <a href="/tags/Docker/" style="font-size: 18.33px;">Docker</a> <a href="/tags/Elasticsearch核心技术/" style="font-size: 10px;">Elasticsearch核心技术</a> <a href="/tags/Flink/" style="font-size: 13.33px;">Flink</a> <a href="/tags/Flink-Storm-SparkStream对比/" style="font-size: 10px;">Flink Storm SparkStream对比</a> <a href="/tags/IDEA/" style="font-size: 10px;">IDEA</a> <a href="/tags/Kebernetes/" style="font-size: 10px;">Kebernetes</a> <a href="/tags/Kubernetes/" style="font-size: 10px;">Kubernetes</a> <a href="/tags/Lamda/" style="font-size: 10px;">Lamda</a> <a href="/tags/MQ/" style="font-size: 10px;">MQ</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Network/" style="font-size: 10px;">Network</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Python基础/" style="font-size: 10px;">Python基础</a> <a href="/tags/Scala/" style="font-size: 11.67px;">Scala</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/Spark/" style="font-size: 10px;">Spark</a> <a href="/tags/Swarm/" style="font-size: 10px;">Swarm</a> <a href="/tags/command/" style="font-size: 20px;">command</a> <a href="/tags/overview/" style="font-size: 10px;">overview</a> <a href="/tags/su-sudo/" style="font-size: 10px;">su-sudo</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/入门/" style="font-size: 16.67px;">入门</a> <a href="/tags/内存与磁盘管理/" style="font-size: 10px;">内存与磁盘管理</a> <a href="/tags/创建型设计模式/" style="font-size: 10px;">创建型设计模式</a> <a href="/tags/原则-规范-重构/" style="font-size: 10px;">原则-规范-重构</a> <a href="/tags/基础入门/" style="font-size: 10px;">基础入门</a> <a href="/tags/实践一/" style="font-size: 10px;">实践一</a> <a href="/tags/实践三/" style="font-size: 10px;">实践三</a> <a href="/tags/实践二/" style="font-size: 10px;">实践二</a> <a href="/tags/帮助命令/" style="font-size: 10px;">帮助命令</a> <a href="/tags/打包压缩与解压缩/" style="font-size: 10px;">打包压缩与解压缩</a> <a href="/tags/数据持久化/" style="font-size: 10px;">数据持久化</a> <a href="/tags/文件及目录权限/" style="font-size: 10px;">文件及目录权限</a> <a href="/tags/文件查看命令/" style="font-size: 10px;">文件查看命令</a> <a href="/tags/文件管理命令/" style="font-size: 10px;">文件管理命令</a> <a href="/tags/文本查看命令/" style="font-size: 10px;">文本查看命令</a> <a href="/tags/用户和权限管理/" style="font-size: 10px;">用户和权限管理</a> <a href="/tags/结构型设计模式/" style="font-size: 10px;">结构型设计模式</a> <a href="/tags/网络管理/" style="font-size: 15px;">网络管理</a> <a href="/tags/行为型设计模式/" style="font-size: 10px;">行为型设计模式</a> <a href="/tags/语法/" style="font-size: 10px;">语法</a> <a href="/tags/软件包管理器和内核升级/" style="font-size: 10px;">软件包管理器和内核升级</a> <a href="/tags/运行时架构/" style="font-size: 10px;">运行时架构</a> <a href="/tags/进程管理/" style="font-size: 10px;">进程管理</a> <a href="/tags/进阶/" style="font-size: 10px;">进阶</a> <a href="/tags/逻辑卷管理/" style="font-size: 10px;">逻辑卷管理</a> <a href="/tags/镜像的构建和发布及容器操作/" style="font-size: 10px;">镜像的构建和发布及容器操作</a> <a href="/tags/高效员工起航训练营/" style="font-size: 10px;">高效员工起航训练营</a> <a href="/tags/高阶/" style="font-size: 10px;">高阶</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>
<script src="/js/search.js"></script>
<script src="/js/main.js"></script>


  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  <script src="/js/particles.js"></script>







  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  <script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script>
  <script src="/js/animate.js"></script>


  <script src="/js/pop-img.js"></script>
  <script>
     $(".article-entry p img").popImg();
  </script>

  </div>
</body>
</html>